## CSharpier
CSharpier is an opinionated code formatter for c#. It uses Roslyn to parse your code and re-prints it using its own rules. The printing process was ported from [prettier](https://github.com/prettier/prettier) but has evolved over time.

### Work In Progress
CSharpier is still in active development.
- The rules it uses to format code are not yet finalized and some of the results are a little ugly.
- The rules it uses to format your code will change over time.
- It has been tested against a large number of public repositories to validate that the changes it makes do not lose any syntax but there is a possibility it will break your code.
    - This process has been automated and runs each time code is pushed.


I encourage you to try it out on your own code and report any bugs, code that doesn't format well, or opinions on how you think the formatting should change. If you can live with the fact that the formatting will be changing over time, it is reasonably safe to use. In addition to a steadily growing set of unit tests; csharpier is tested against ~60k c# files from a range of public repositories to validate it does not result in the lose of any source code. 

### Features
  - It is fast. It can format a solution of ~11,000 files in ~30 seconds.
  - It supports validating the syntax of the code it produces to ensure the only changes made were whitespace and line breaks.
  - It formats c# <= 9.0

Try it out at [Playground](https://csharpier.bnt-studios.com)

### Before
```c#
public class ClassName {
    public string ShortPropertyName {
        get;
        set; 
    }

    public void LongUglyMethod(string longParameter1, string longParameter2, string longParameter3) { 
        this.LongUglyMethod("1234567890", "abcdefghijklmnopqrstuvwxyz", "ABCDEFGHIJKLMNOPQRSTUVWXYZ");
    }
}
```

### After
```c#
public class ClassName
{
    public string ShortPropertyName { get; set; }

    public void LongUglyMethod(
        string longParameter1,
        string longParameter2,
        string longParameter3)
    {
        this.LongUglyMethod(
            "1234567890",
            "abcdefghijklmnopqrstuvwxyz",
            "ABCDEFGHIJKLMNOPQRSTUVWXYZ");
    }
}
```

## Installation
```console
dotnet tool install -g csharpier
```

## Basic Usage
By default csharpier will validate any files it formats by comparing the resulting syntax tree to the original.
Formatting will take longer, but csharpier will validate the formatted syntax tree against the original and warn if it believes it introduced breaking changes.

Run csharpier from the directory you wish to format.
```console
dotnet csharpier
```

## Configuration
CSharpier has support for a configuration file. You can use any of the following files
- A ```.csharpierrc``` file in JSON or YAML.
- A ```.csharpierrc.json``` or ```.csharpierrc.yaml``` file.

### Configuration Options
JSON
```json
{
   "printWidth": 100,
   "useTabs": false,
   "tabWidth": 4,
   "endOfLine": "lf"
}
```
YAML
```json
printWidth: 100
useTabs: false
tabWidth: 4
endOfLine: lf
```

#### Print Width
Specify at what point the printer will wrap content. This is not a hard limit. Some lines will be shorter or longer.

Default 100
#### Use Tabs
Indent lines with tabs instead of spaces.

Default false
#### Tab Width
Specify the number of spaces used per indentation level.

Default 4
#### End of Line
Specify what type of line endings will be printed in files.
Options
- "lf" - Line feed only (\n) **Default**
- "crlf" Carriage return and line feed (\r\n) 

### Ignoring Files
Csharpier will ignore the following files
- Any file that begins with ```TemporaryGeneratedFile_```
- Any file that ends with ```.designer.cs```
- Any file that ends with ```.generated.cs```
- Any file that ends with ```.g.cs```
- Any file that ends with ```.g.i.cs```
- Any file that begins with a comment that contains ```<autogenerated``` or ```<auto-generated```

Add a ```.csharpierignore``` file to ignore additional files and folders. The file uses [gitignore syntax](https://git-scm.com/docs/gitignore#_pattern_format) 

Example
```
Uploads/
**/App_Data/*.cs
```

### Command Line Options
```console
Usage:
  dotnet-csharpier [options] [<directoryOrFile>]

Arguments:
  <directoryOrFile>    A path to a directory containing files to format or a file to format. If a path is not specified the current directory is used

Options:
  --check           Check that files are formatted. Will not write any changes.
  --fast            Skip comparing syntax tree of formatted file to original file to validate changes.
  --skip-write      Skip writing changes. Generally used for testing to ensure csharpier doesn't throw any errors or cause syntax tree validation failures.
  --version         Show version information
  -?, -h, --help    Show help and usage information


```

### \<directoryOrFile\>
Currently CSharpier only supports being passed a directory to recursively scan for .cs files or a single file to format.
If a directory is not supplied, it will use the current directory.

### --check
Used to check if your files are already formatted. Outputs any files that have not already been formatted. 
This will return exit code 1 if there are unformatted files which is useful for CI pipelines.

### --fast
CSharpier validates the changes it makes to a file. 
It does this by comparing the syntax tree before and after formatting, but ignoring any whitespace trivia in the syntax tree.
If a file fails validation, CSharpier will output the lines that differ. If this happens it indicates a bug in CSharpier's code.  
This validation may be skipped by passing the --fast argument. Validation appears to increase the formatting time by ~50%.

An example of CSharpier finding a file that failed validation.
```
\src\[Snip]\AbstractReferenceFinder_GlobalSuppressions.cs       - failed syntax tree validation
    Original: Around Line 280
            }

            if (prefix.Span[^2] is < 'A' or > 'Z')
            {
                return false;
            }

            if (prefix.Span[^1] is not ':')
    Formatted: Around Line 330
            }

            if (prefix.Span[^2] is )
            {
                return false;
            }

            if (prefix.Span[^1] is not ':')
```

## IDE Support
### Rider
1. Open Settings
2. Tools - File Watchers
3. Add New File Watcher
    * File Type: C# File
    * Program: dotnet
    * Arguments: csharpier $FilePath$
    * Output paths to refresh: $FilePath$
    * Advanced Options - Auto-save edited files...: This should probably be off otherwise if you pause while coding csharpier will reformat the file as is.

## Contributing
See [Development Readme](CONTRIBUTING.md)  

Join Us [![Discord](https://img.shields.io/badge/Discord-chat?label=&logo=discord&logoColor=ffffff&color=7389D8&labelColor=6A7EC2)](https://discord.gg/HfAKGEZQcX)

[ChangeLog](CHANGELOG.md)
